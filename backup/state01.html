<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Qubit Probability Visualizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: "Inter", sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; /* Align to top for better content flow */
            min-height: 100vh;
            background-color: #1a202c; /* Dark background */
            color: #e2e8f0; /* Light text */
            padding: 1.5rem; /* p-6 */
            box-sizing: border-box;
        }
        h1 {
            text-align: center;
            margin-bottom: 1.5rem; /* mb-6 */
            color: #63b3ed; /* blue-300 */
        }
        .container {
            background-color: #2d3748; /* Darker background */
            padding: 1.5rem; /* p-6 */
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.5); /* shadow-lg */
            width: 100%;
            max-width: 800px;
            margin-bottom: 1.5rem; /* mb-6 */
        }
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.75rem; /* gap-3 */
            margin-top: 1rem; /* mt-4 */
        }
        button, select {
            background-color: #4299e1; /* blue-500 */
            color: white;
            padding: 0.75rem 1rem; /* py-3 px-4 */
            border-radius: 0.75rem; /* rounded-xl */
            font-weight: 600; /* font-semibold */
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3); /* shadow-md */
            border: none;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            background-image: linear-gradient(to right, #4299e1, #3182ce); /* Gradient */
            text-align: center;
            -webkit-appearance: none; /* Remove default select styling */
            -moz-appearance: none;
            appearance: none;
        }
        button:hover, select:hover {
            background-color: #3182ce; /* blue-600 */
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.4);
            background-image: linear-gradient(to right, #3182ce, #2c5282); /* Darker gradient */
        }
        button:active, select:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem; /* gap-2 */
            margin-bottom: 1rem; /* mb-4 */
        }
        .input-group label {
            font-weight: 500;
            color: #cbd5e0; /* gray-300 */
        }
        input[type="number"] {
            background-color: #4a5568; /* gray-600 */
            border: 1px solid #63b3ed; /* blue-300 */
            border-radius: 0.5rem; /* rounded-lg */
            padding: 0.5rem 0.75rem; /* py-2 px-3 */
            color: #e2e8f0;
            width: 100%;
            box-sizing: border-box;
        }
        .probability-display {
            margin-top: 1.5rem; /* mt-6 */
            max-height: 400px; /* Limit height for scroll if many states */
            overflow-y: auto;
            padding-right: 0.5rem; /* For scrollbar */
        }
        .probability-bar-container {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem; /* mb-2 */
            font-size: 0.9rem;
        }
        .probability-label {
            width: 60px; /* Fixed width for labels */
            flex-shrink: 0;
            text-align: right;
            padding-right: 0.5rem;
            color: #cbd5e0;
        }
        .probability-bar {
            height: 20px;
            background-color: #4299e1; /* blue-500 */
            border-radius: 0.25rem; /* rounded */
            transition: width 0.5s ease-out;
            margin-right: 0.5rem;
        }
        .probability-value {
            color: #a0aec0; /* gray-400 */
            min-width: 50px; /* Ensure space for percentage */
        }
        .result-box {
            background-color: #2d3748;
            padding: 1rem;
            border-radius: 0.75rem;
            margin-top: 1.5rem;
            width: 90%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body>
    <h1 class="text-3xl font-bold">Multi-Qubit Probability Visualizer</h1>

    <div class="container">
        <div class="input-group">
            <label for="numQubits">Number of Qubits (1-5):</label>
            <input type="number" id="numQubits" value="2" min="1" max="5">
        </div>

        <div class="controls-grid">
            <button id="initCircuitBtn">Initialize Circuit</button>
            <button id="resetBtn">Reset All Qubits</button>
            <button id="measureAllBtn">Measure All</button>
        </div>

        <hr class="my-4 border-gray-600">

        <div class="input-group">
            <label for="singleQubitSelect">Apply Single-Qubit Gate to Qubit:</label>
            <select id="singleQubitSelect"></select>
        </div>
        <div class="controls-grid">
            <button id="hGateBtn">Hadamard (H)</button>
            <button id="xGateBtn">Pauli-X (X)</button>
            <button id="yGateBtn">Pauli-Y (Y)</button>
            <button id="zGateBtn">Pauli-Z (Z)</button>
        </div>

        <hr class="my-4 border-gray-600">

        <div class="input-group">
            <label>Apply CNOT Gate:</label>
            <div class="flex gap-3">
                <select id="cnotControlSelect" class="flex-1"></select>
                <span class="text-gray-300 self-center">Control</span>
                <select id="cnotTargetSelect" class="flex-1"></select>
                <span class="text-gray-300 self-center">Target</span>
            </div>
            <button id="cnotGateBtn">CNOT</button>
        </div>
    </div>

    <div class="container">
        <h2 class="text-xl font-semibold mb-4 text-blue-300">Current State Probabilities</h2>
        <div id="probabilityDisplay" class="probability-display">
            <!-- Probability bars will be rendered here -->
        </div>
    </div>

    <div id="resultDisplay" class="result-box">
        <p>Last Measurement Outcome: <span id="measurementOutcome">N/A</span></p>
    </div>

    <script type="module">
        import QuantumCircuit from 'https://unpkg.com/quantum-circuit@latest/lib/index.js';

        let quantumCircuit;
        let numQubits = 2; // Default number of qubits

        const numQubitsInput = document.getElementById('numQubits');
        const initCircuitBtn = document.getElementById('initCircuitBtn');
        const resetBtn = document.getElementById('resetBtn');
        const hGateBtn = document.getElementById('hGateBtn');
        const xGateBtn = document.getElementById('xGateBtn');
        const yGateBtn = document.getElementById('yGateBtn');
        const zGateBtn = document.getElementById('zGateBtn');
        const cnotGateBtn = document.getElementById('cnotGateBtn');
        const measureAllBtn = document.getElementById('measureAllBtn');

        const singleQubitSelect = document.getElementById('singleQubitSelect');
        const cnotControlSelect = document.getElementById('cnotControlSelect');
        const cnotTargetSelect = document.getElementById('cnotTargetSelect');

        const probabilityDisplay = document.getElementById('probabilityDisplay');
        const measurementOutcomeSpan = document.getElementById('measurementOutcome');

        // Function to initialize or re-initialize the quantum circuit
        function initializeCircuit() {
            numQubits = parseInt(numQubitsInput.value);
            if (isNaN(numQubits) || numQubits < 1 || numQubits > 5) {
                alert('Please enter a number of qubits between 1 and 5.');
                numQubitsInput.value = 2; // Reset to default
                numQubits = 2;
            }

            quantumCircuit = new QuantumCircuit(numQubits);
            populateQubitSelectors();
            updateProbabilityDisplay();
            measurementOutcomeSpan.textContent = 'N/A';
        }

        // Populates the dropdowns for qubit selection
        function populateQubitSelectors() {
            singleQubitSelect.innerHTML = '';
            cnotControlSelect.innerHTML = '';
            cnotTargetSelect.innerHTML = '';

            for (let i = 0; i < numQubits; i++) {
                const option1 = document.createElement('option');
                option1.value = i;
                option1.textContent = `Qubit ${i}`;
                singleQubitSelect.appendChild(option1);

                const option2 = document.createElement('option');
                option2.value = i;
                option2.textContent = `Qubit ${i}`;
                cnotControlSelect.appendChild(option2);

                const option3 = document.createElement('option');
                option3.value = i;
                option3.textContent = `Qubit ${i}`;
                cnotTargetSelect.appendChild(option3);
            }

            // Ensure CNOT control and target are different initially if possible
            if (numQubits >= 2) {
                cnotControlSelect.value = 0;
                cnotTargetSelect.value = 1;
            }
        }

        // Updates the visual representation of probabilities
        function updateProbabilityDisplay() {
            probabilityDisplay.innerHTML = '';
            const stateVector = quantumCircuit.stateVector;
            const numStates = 1 << numQubits; // 2^numQubits

            for (let i = 0; i < numStates; i++) {
                const amplitude = stateVector[i];
                const probability = (amplitude.re * amplitude.re + amplitude.im * amplitude.im);
                const percentage = (probability * 100).toFixed(2);

                const binaryState = i.toString(2).padStart(numQubits, '0'); // Convert index to binary string

                const barContainer = document.createElement('div');
                barContainer.className = 'probability-bar-container';

                const label = document.createElement('span');
                label.className = 'probability-label';
                label.textContent = `|${binaryState}⟩:`;
                barContainer.appendChild(label);

                const bar = document.createElement('div');
                bar.className = 'probability-bar';
                bar.style.width = `${percentage}%`;
                barContainer.appendChild(bar);

                const value = document.createElement('span');
                value.className = 'probability-value';
                value.textContent = `${percentage}%`;
                barContainer.appendChild(value);

                probabilityDisplay.appendChild(barContainer);
            }
        }

        // Resets all qubits to |0...0> state
        function resetAllQubits() {
            initializeCircuit(); // Re-initializes the circuit to all |0>
        }

        // Applies a single-qubit gate
        function applySingleQubitGate(gateName) {
            const qubitIndex = parseInt(singleQubitSelect.value);
            if (isNaN(qubitIndex)) {
                alert('Please select a qubit.');
                return;
            }
            quantumCircuit.appendGate(gateName, [qubitIndex]);
            updateProbabilityDisplay();
            measurementOutcomeSpan.textContent = 'N/A';
        }

        // Applies a CNOT gate
        function applyCnotGate() {
            const controlQubit = parseInt(cnotControlSelect.value);
            const targetQubit = parseInt(cnotTargetSelect.value);

            if (isNaN(controlQubit) || isNaN(targetQubit)) {
                alert('Please select both control and target qubits.');
                return;
            }
            if (controlQubit === targetQubit) {
                alert('Control and target qubits cannot be the same!');
                return;
            }

            quantumCircuit.appendGate('cx', [controlQubit, targetQubit]);
            updateProbabilityDisplay();
            measurementOutcomeSpan.textContent = 'N/A';
        }

        // Measures all qubits
        function measureAllQubits() {
            const result = quantumCircuit.measureAll();
            measurementOutcomeSpan.textContent = result.result;
            // Probabilities are already displayed by updateProbabilityDisplay
        }

        // Event Listeners
        numQubitsInput.addEventListener('change', initializeCircuit);
        initCircuitBtn.addEventListener('click', initializeCircuit);
        resetBtn.addEventListener('click', resetAllQubits);
        measureAllBtn.addEventListener('click', measureAllQubits);
        hGateBtn.addEventListener('click', () => applySingleQubitGate('h'));
        xGateBtn.addEventListener('click', () => applySingleQubitGate('x'));
        yGateBtn.addEventListener('click', () => applySingleQubitGate('y'));
        zGateBtn.addEventListener('click', () => applySingleQubitGate('z'));
        cnotGateBtn.addEventListener('click', applyCnotGate);

        // Initial setup on load
        window.onload = initializeCircuit;
    </script>
</body>
</html>
