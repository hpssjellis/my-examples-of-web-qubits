<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Two-Qubit CNOT Gate Visualizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: "Inter", sans-serif;
            background-color: #1a202c; /* Dark background */
            color: #e2e8f0; /* Light text */
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden; /* Prevent horizontal scroll */
        }
        .container {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            padding: 1.5rem;
            max-width: 1200px;
            width: 100%;
            box-sizing: border-box;
        }
        @media (min-width: 1024px) {
            .container {
                flex-direction: row;
                justify-content: space-around;
                align-items: flex-start; /* Align panels at the top */
            }
        }
        .panel {
            background-color: #2d3748; /* Darker panel background */
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            flex: 1;
            min-width: 300px;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        label {
            font-weight: 600;
            color: #cbd5e0;
        }
        input[type="number"] {
            background-color: #4a5568;
            border: 1px solid #6b7280;
            border-radius: 0.375rem;
            padding: 0.5rem 0.75rem;
            color: #e2e8f0;
            width: 100%;
            box-sizing: border-box;
        }
        input[type="number"]:focus {
            outline: none;
            border-color: #63b3ed;
            box-shadow: 0 0 0 2px rgba(99, 179, 237, 0.5);
        }
        button {
            background-color: #4299e1; /* Blue button */
            color: white;
            padding: 0.75rem 1.25rem;
            border-radius: 0.5rem;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
            border: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        button:hover {
            background-color: #3182ce;
            transform: translateY(-1px);
        }
        button:active {
            transform: translateY(0);
            box-shadow: none;
        }
        .output-group {
            background-color: #1a202c;
            padding: 0.75rem;
            border-radius: 0.375rem;
            color: #a0aec0;
            font-family: 'Courier New', Courier, monospace;
            word-break: break-all;
            white-space: pre-wrap;
            min-height: 2.5rem;
            display: flex;
            align-items: center;
        }
        .output-complex {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
        }
        .output-complex > div {
            background-color: #1a202c;
            padding: 0.75rem;
            border-radius: 0.375rem;
            color: #a0aec0;
            font-family: 'Courier New', Courier, monospace;
            word-break: break-all;
            white-space: pre-wrap;
            min-height: 2.5rem;
            display: flex;
            align-items: center;
        }
        .output-probabilities {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
        }
        .output-probabilities > div {
            background-color: #1a202c;
            padding: 0.75rem;
            border-radius: 0.375rem;
            color: #a0aec0;
            font-family: 'Courier New', Courier, monospace;
            word-break: break-all;
            white-space: pre-wrap;
            min-height: 2.5rem;
            display: flex;
            align-items: center;
        }

        .error-message {
            color: #fc8181; /* Red for errors */
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }
        h1 {
            color: #63b3ed;
            text-align: center;
            margin-bottom: 2rem;
            font-size: 2.5rem;
        }
        .info-text {
            font-size: 0.9rem;
            color: #a0aec0;
            margin-top: 1rem;
            line-height: 1.5;
        }
        .info-text strong {
            color: #cbd5e0;
        }
        .circuit-diagram {
            background-color: #1a202c;
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: 'Courier New', Courier, monospace;
            font-size: 1rem;
            line-height: 1.8;
            white-space: pre;
            overflow-x: auto;
            color: #a0aec0;
        }
        select {
            background-color: #4a5568;
            border: 1px solid #6b7280;
            border-radius: 0.375rem;
            padding: 0.5rem 0.75rem;
            color: #e2e8f0;
            width: 100%;
            box-sizing: border-box;
        }
        select:focus {
            outline: none;
            border-color: #63b3ed;
            box-shadow: 0 0 0 2px rgba(99, 179, 237, 0.5);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="panel">
            <h2 class="text-xl font-bold text-center mb-4">Initial Two-Qubit State</h2>
            <div class="info-text mb-4">
                <p>Define the initial state of your two-qubit system. This is a 4-dimensional complex vector:</p>
                <p>$|\psi\rangle = \alpha_{00}|00\rangle + \alpha_{01}|01\rangle + \alpha_{10}|10\rangle + \alpha_{11}|11\rangle$</p>
                <p>Remember that the sum of the squares of the magnitudes of all amplitudes must be 1: $|\alpha_{00}|^2 + |\alpha_{01}|^2 + |\alpha_{10}|^2 + |\alpha_{11}|^2 = 1$.</p>
                <p>A common starting point for entanglement is the state $|+\rangle|0\rangle = \frac{1}{\sqrt{2}}(|00\rangle + |10\rangle)$, which is set as the default.</p>
            </div>
            <div class="input-group">
                <label for="alpha00_re">α₀₀ Real Part:</label>
                <input type="number" id="alpha00_re" value="0.4746" step="0.0001">
            </div>
            <div class="input-group">
                <label for="alpha00_im">α₀₀ Imaginary Part:</label>
                <input type="number" id="alpha00_im" value="0.1898" step="0.0001">
            </div>
            <div class="input-group">
                <label for="alpha01_re">α₀₁ Real Part:</label>
                <input type="number" id="alpha01_re" value="0.2847" step="0.0001">
            </div>
            <div class="input-group">
                <label for="alpha01_im">α₀₁ Imaginary Part:</label>
                <input type="number" id="alpha01_im" value="-0.3796" step="0.0001">
            </div>
            <div class="input-group">
                <label for="alpha10_re">α₁₀ Real Part:</label>
                <input type="number" id="alpha10_re" value="-0.0949" step="0.0001">
            </div>
            <div class="input-group">
                <label for="alpha10_im">α₁₀ Imaginary Part:</label>
                <input type="number" id="alpha10_im" value="0.5695" step="0.0001">
            </div>
            <div class="input-group">
                <label for="alpha11_re">α₁₁ Real Part:</label>
                <input type="number" id="alpha11_re" value="0.3796" step="0.0001">
            </div>
            <div class="input-group">
                <label for="alpha11_im">α₁₁ Imaginary Part:</label>
                <input type="number" id="alpha11_im" value="-0.1898" step="0.0001">
            </div>
            <button id="applyInitialStateBtn">Set Initial State</button>
            <div class="error-message" id="initialStateError"></div>
        </div>

        <div class="panel">
            <h2 class="text-xl font-bold text-center mb-4">Apply CNOT Gate</h2>
            <div class="info-text mb-4">
                <p>The **CNOT (Controlled-NOT) gate** flips the target qubit if the control qubit is $|1\rangle$. If the control is $|0\rangle$, the target remains unchanged.</p>
                <p>This gate is essential for creating **entanglement**.</p>
            </div>
            <div class="input-group">
                <label for="controlQubit">Control Qubit:</label>
                <select id="controlQubit">
                    <option value="0">Qubit 1</option>
                    <option value="1">Qubit 2</option>
                </select>
            </div>
            <div class="input-group">
                <label for="targetQubit">Target Qubit:</label>
                <select id="targetQubit">
                    <option value="1">Qubit 2</option>
                    <option value="0">Qubit 1</option>
                </select>
            </div>
            <button id="applyCNOTBtn">Apply CNOT Gate</button>
            <div class="error-message" id="cnotError"></div>

            <h3 class="text-lg font-bold mt-6 mb-2">Quantum Circuit Diagram</h3>
            <div class="circuit-diagram" id="circuitDiagram">
                Qubit 1: |0> ---
                Qubit 2: |0> ---
            </div>
        </div>

        <div class="panel">
            <h2 class="text-xl font-bold text-center mb-4">Resulting Two-Qubit State</h2>
            <h3 class="text-lg font-bold mb-2">Complex Amplitudes:</h3>
            <div class="output-complex">
                <div>α₀₀: <span id="out_alpha00"></span></div>
                <div>α₀₁: <span id="out_alpha01"></span></div>
                <div>α₁₀: <span id="out_alpha10"></span></div>
                <div>α₁₁: <span id="out_alpha11"></span></div>
            </div>

            <h3 class="text-lg font-bold mt-6 mb-2">Measurement Probabilities:</h3>
            <div class="output-probabilities">
                <div>P(|00⟩): <span id="prob00"></span></div>
                <div>P(|01⟩): <span id="prob01"></span></div>
                <div>P(|10⟩): <span id="prob10"></span></div>
                <div>P(|11⟩): <span id="prob11"></span></div>
            </div>
            <div class="info-text mt-4">
                <p>The **complex amplitudes** show the full quantum state, including phase information crucial for entanglement.</p>
                <p>The **measurement probabilities** tell you the likelihood of observing each classical outcome when you measure the qubits.</p>
            </div>
        </div>
    </div>

    <script>
        // Complex number class (reused from previous app)
        class Complex {
            constructor(re, im) {
                this.re = re;
                this.im = im;
            }

            magnitude() {
                return Math.sqrt(this.re * this.re + this.im * this.im);
            }

            magnitudeSq() {
                return this.re * this.re + this.im * this.im;
            }

            multiply(other) {
                return new Complex(
                    this.re * other.re - this.im * other.im,
                    this.re * other.im + this.im * other.re
                );
            }

            // For multiplying by a scalar
            scale(scalar) {
                return new Complex(this.re * scalar, this.im * scalar);
            }

            toString() {
                if (this.im === 0) return this.re.toFixed(4);
                if (this.re === 0) return this.im.toFixed(4) + 'i';
                return `${this.re.toFixed(4)} ${this.im >= 0 ? '+' : '-'} ${Math.abs(this.im).toFixed(4)}i`;
            }
        }

        // Global state vector for two qubits (4 complex amplitudes)
        // Initial state set to a non-trivial, normalized superposition
        let twoQubitState = [
            new Complex(0.4746, 0.1898), // alpha00 for |00>
            new Complex(0.2847, -0.3796),// alpha01 for |01>
            new Complex(-0.0949, 0.5695),// alpha10 for |10>
            new Complex(0.3796, -0.1898) // alpha11 for |11>
        ];

        // Function to update the displayed state and probabilities
        function updateDisplay() {
            const totalMagnitudeSq = twoQubitState.reduce((sum, c) => sum + c.magnitudeSq(), 0);
            let normalizedState = twoQubitState.map(c => c.scale(1 / Math.sqrt(totalMagnitudeSq)));

            // Display complex amplitudes
            document.getElementById('out_alpha00').textContent = normalizedState[0].toString();
            document.getElementById('out_alpha01').textContent = normalizedState[1].toString();
            document.getElementById('out_alpha10').textContent = normalizedState[2].toString();
            document.getElementById('out_alpha11').textContent = normalizedState[3].toString();

            // Display probabilities
            document.getElementById('prob00').textContent = (normalizedState[0].magnitudeSq() * 100).toFixed(2) + '%';
            document.getElementById('prob01').textContent = (normalizedState[1].magnitudeSq() * 100).toFixed(2) + '%';
            document.getElementById('prob10').textContent = (normalizedState[2].magnitudeSq() * 100).toFixed(2) + '%';
            document.getElementById('prob11').textContent = (normalizedState[3].magnitudeSq() * 100).toFixed(2) + '%';
        }

        // Function to normalize the state vector (ensures sum of probabilities is 1)
        function normalizeStateVector(stateVector) {
            const sumOfSquares = stateVector.reduce((sum, c) => sum + c.magnitudeSq(), 0);
            if (sumOfSquares === 0) {
                // Handle the case of a zero vector (e.g., return zero vector or throw error)
                return stateVector.map(() => new Complex(0, 0));
            }
            const normFactor = Math.sqrt(sumOfSquares);
            return stateVector.map(c => c.scale(1 / normFactor));
        }

        // Function to apply a 4x4 matrix to a 4-element complex vector
        function applyMatrix(matrix, stateVector) {
            let newState = [new Complex(0, 0), new Complex(0, 0), new Complex(0, 0), new Complex(0, 0)];
            for (let i = 0; i < 4; i++) {
                for (let j = 0; j < 4; j++) {
                    newState[i] = newState[i].add(matrix[i][j].multiply(stateVector[j]));
                }
            }
            return newState;
        }

        // Add method to Complex class for addition
        Complex.prototype.add = function(other) {
            return new Complex(this.re + other.re, this.im + other.im);
        };

        // CNOT Gate Matrices
        // Qubit 1 (Control), Qubit 2 (Target)
        const CNOT_Q1_Control_Q2_Target = [
            [new Complex(1,0), new Complex(0,0), new Complex(0,0), new Complex(0,0)],
            [new Complex(0,0), new Complex(1,0), new Complex(0,0), new Complex(0,0)],
            [new Complex(0,0), new Complex(0,0), new Complex(0,0), new Complex(1,0)],
            [new Complex(0,0), new Complex(0,0), new Complex(1,0), new Complex(0,0)]
        ];

        // Qubit 2 (Control), Qubit 1 (Target)
        const CNOT_Q2_Control_Q1_Target = [
            [new Complex(1,0), new Complex(0,0), new Complex(0,0), new Complex(0,0)],
            [new Complex(0,0), new Complex(0,0), new Complex(0,0), new Complex(1,0)],
            [new Complex(0,0), new Complex(0,0), new Complex(1,0), new Complex(0,0)],
            [new Complex(0,0), new Complex(1,0), new Complex(0,0), new Complex(0,0)]
        ];

        // Function to update the circuit diagram
        function updateCircuitDiagram(control, target, operation = 'initial') {
            const diagramDiv = document.getElementById('circuitDiagram');
            let diagram = '';

            if (operation === 'initial') {
                diagram = `Qubit 1: |0> ---
Qubit 2: |0> ---`;
            } else if (operation === 'CNOT') {
                const controlLine = control === 0 ? 'Qubit 1' : 'Qubit 2';
                const targetLine = target === 0 ? 'Qubit 1' : 'Qubit 2';

                if (control === 0 && target === 1) { // Q1 Control, Q2 Target
                    diagram = `Qubit 1: |0> ---●---
Qubit 2: |0> ---|---X---`;
                } else { // Q2 Control, Q1 Target
                    diagram = `Qubit 1: |0> ---|---X---
Qubit 2: |0> ---●---`;
                }
            }
            diagramDiv.textContent = diagram;
        }

        // --- Event Listeners ---

        document.getElementById('applyInitialStateBtn').addEventListener('click', () => {
            const alpha00_re = parseFloat(document.getElementById('alpha00_re').value);
            const alpha00_im = parseFloat(document.getElementById('alpha00_im').value);
            const alpha01_re = parseFloat(document.getElementById('alpha01_re').value);
            const alpha01_im = parseFloat(document.getElementById('alpha01_im').value);
            const alpha10_re = parseFloat(document.getElementById('alpha10_re').value);
            const alpha10_im = parseFloat(document.getElementById('alpha10_im').value);
            const alpha11_re = parseFloat(document.getElementById('alpha11_re').value);
            const alpha11_im = parseFloat(document.getElementById('alpha11_im').value);

            const initialStateErrorDiv = document.getElementById('initialStateError');
            initialStateErrorDiv.textContent = '';

            if (isNaN(alpha00_re) || isNaN(alpha00_im) || isNaN(alpha01_re) || isNaN(alpha01_im) ||
                isNaN(alpha10_re) || isNaN(alpha10_im) || isNaN(alpha11_re) || isNaN(alpha11_im)) {
                initialStateErrorDiv.textContent = 'Please enter valid numbers for all complex parts.';
                return;
            }

            const tempState = [
                new Complex(alpha00_re, alpha00_im),
                new Complex(alpha01_re, alpha01_im),
                new Complex(alpha10_re, alpha10_im),
                new Complex(alpha11_re, alpha11_im)
            ];

            const sumOfSquares = tempState.reduce((sum, c) => sum + c.magnitudeSq(), 0);
            if (Math.abs(sumOfSquares - 1) > 1e-6) { // Check normalization with a small tolerance
                initialStateErrorDiv.textContent = `Normalization error: |α₀₀|² + ... + |α₁₁|² = ${sumOfSquares.toFixed(4)}, should be 1.`;
                return;
            }

            twoQubitState = tempState;
            updateDisplay();
            updateCircuitDiagram(0, 0, 'initial'); // Reset diagram
        });

        document.getElementById('applyCNOTBtn').addEventListener('click', () => {
            const controlQubit = parseInt(document.getElementById('controlQubit').value);
            const targetQubit = parseInt(document.getElementById('targetQubit').value);

            const cnotErrorDiv = document.getElementById('cnotError');
            cnotErrorDiv.textContent = '';

            if (controlQubit === targetQubit) {
                cnotErrorDiv.textContent = 'Control and Target qubits cannot be the same.';
                return;
            }

            let cnotMatrix;
            if (controlQubit === 0 && targetQubit === 1) { // Q1 Control, Q2 Target
                cnotMatrix = CNOT_Q1_Control_Q2_Target;
            } else { // Q2 Control, Q1 Target
                cnotMatrix = CNOT_Q2_Control_Q1_Target;
            }

            twoQubitState = applyMatrix(cnotMatrix, twoQubitState);
            twoQubitState = normalizeStateVector(twoQubitState); // Re-normalize after gate application
            updateDisplay();
            updateCircuitDiagram(controlQubit, targetQubit, 'CNOT');
        });

        // Initialize display on page load
        window.onload = function() {
            updateDisplay();
            updateCircuitDiagram(0, 0, 'initial');
        };
    </script>
</body>
</html>
